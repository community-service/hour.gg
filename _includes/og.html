{%- assign site_title = site.title | default: "Community Service Hour" -%}
{%- assign site_description = site.description | default: "Open source every week." -%}

{%- assign body_html = content | default: page.content -%}

{%- assign raw_title = page.og_title | default: page.title -%}
{%- if raw_title == nil or raw_title == "" -%}
  {%- assign h1_parts = body_html | split: "<h1" -%}
  {%- if h1_parts.size > 1 -%}
    {%- assign h1_after = h1_parts[1] | split: ">" -%}
    {%- assign raw_title = h1_after[1] | split: "</h1>" | first | strip_html | strip_newlines | strip -%}
  {%- endif -%}
{%- endif -%}

{%- assign page_title = raw_title | default: site_title -%}
{%- if page_title != site_title -%}
  {%- assign full_title = page_title | append: " | " | append: site_title -%}
{%- else -%}
  {%- assign full_title = site_title -%}
{%- endif -%}

{%- assign raw_description = page.og_description | default: page.description | default: page.excerpt -%}
{%- assign full_description = raw_description | default: site_description | strip_html | strip_newlines | replace: "  ", " " | strip | truncate: 200 -%}

{%- assign og_image = page.og_image | default: "/assets/og.webp" -%}
{%- assign og_url = page.url | absolute_url -%}
{%- assign og_image_abs = og_image | absolute_url -%}

{%- assign og_type = page.og_type | default: "website" -%}
{%- if page.collection == "episodes" -%}
  {%- assign og_type = "article" -%}
{%- endif -%}

<title>{{ full_title | escape }}</title>
<meta name="description" content="{{ full_description | escape }}">
<link rel="canonical" href="{{ og_url }}">

<meta property="og:site_name" content="{{ site_title | escape }}">
<meta property="og:title" content="{{ full_title | escape }}">
<meta property="og:description" content="{{ full_description | escape }}">
<meta property="og:type" content="{{ og_type }}">
<meta property="og:url" content="{{ og_url }}">
<meta property="og:image" content="{{ og_image_abs }}">
<meta property="og:image:alt" content="{{ site_title | escape }}">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ full_title | escape }}">
<meta name="twitter:description" content="{{ full_description | escape }}">
<meta name="twitter:image" content="{{ og_image_abs }}">
{%- if site.twitter_username and site.twitter_username != "" -%}
<meta name="twitter:site" content="@{{ site.twitter_username }}">
{%- endif -%}
